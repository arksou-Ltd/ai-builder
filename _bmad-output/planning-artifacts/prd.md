---
stepsCompleted: ['step-01-init', 'step-02-discovery', 'step-03-success', 'step-04-journeys', 'step-05-domain', 'step-06-innovation', 'step-07-project-type', 'step-08-scoping', 'step-09-functional', 'step-10-nonfunctional', 'step-11-polish', 'step-12-complete', 'step-e-01-discovery', 'step-e-02-review', 'step-e-03-edit']
workflowStatus: 'completed'
completedAt: '2026-01-31'
inputDocuments:
  - '_bmad-output/planning-artifacts/product-brief-ai-builder-2026-01-31.md'
documentCounts:
  brief: 1
  research: 0
  brainstorming: 0
  projectDocs: 0
classification:
  projectType: 'SaaS B2B + Developer Tool'
  domain: 'DevTools'
  complexity: 'medium'
  projectContext: 'greenfield'
workflowType: 'prd'
date: 2026-01-31
author: Arksou
lastEdited: '2026-02-04'
editHistory:
  - date: '2026-01-31'
    changes: '为 56 个功能需求（FR1-FR56）补充验收标准，提升 SMART Measurable 评分'
  - date: '2026-02-04'
    changes: '补充 Epic 2（Identity & Workspace Setup）的 story 拆分与验收标准'
  - date: '2026-02-04'
    changes: '统一 Clerk 认证、补充 Story Given/When/Then、补齐 RBAC/订阅层级并移除实现细节'
---

# Product Requirements Document - ai-builder

**Author:** Arksou
**Date:** 2026-01-31

## Executive Summary

### Vision

ai-builder 致力于实现"人人都是 AI Builder"的愿景——让非技术人员能够直接将需求转化为符合项目规范的高质量代码，彻底改变传统软件开发中 PM 与研发之间的协作模式。

### Problem Statement

**核心问题：** 现有 AI 开发工具都是为技术人员设计的，没有真正赋能非技术人员。

| 痛点 | 影响 |
|------|------|
| PM 的 demo 无法复用 | 不符合项目架构规范，研发需从零实现 |
| 需求周期过长 | 从提出到上线需要约一个月 |
| 沟通鸿沟 | PM 不懂技术规范，研发难以理解 PM 意图 |
| 创新受阻 | 漫长开发周期抑制快速试错和迭代 |

### Target Users

| 角色 | 画像 | 使用场景 |
|------|------|----------|
| **PM 小李**（主要用户） | 创业公司产品经理，3年+经验，有创新想法渴望快速验证 | 通过对话式交互实现需求，产出80分代码 |
| **研发 小王**（次要用户） | 创业公司开发工程师，负责项目架构和规范维护 | 维护项目规范，Review 并优化 PM 代码至95分 |

### Solution Overview

ai-builder 采用三层架构解决问题：

1. **工作流引导层**：通过界面步骤引导和对话式 AI 交互，让非技术人员按流程完成需求开发
   - **界面引导**：可视化工作流步骤，明确当前所在环节和下一步操作
   - **对话交互**：在每个步骤中，PM 通过自然语言与 AI 沟通，AI 引导 PM 补充和澄清需求细节
2. **项目规范层**：AI 自动学习并遵循 GitHub 项目的架构文档和规范
3. **协作优化层**：PM 产出80分代码，研发审核优化至95分

### Key Differentiators

| 差异化优势 | 说明 |
|-----------|------|
| 非技术人员友好 | 专为 PM 等非技术角色设计，无需编程知识 |
| 项目规范自适应 | 自动遵循项目已有架构和规范，代码可直接复用 |
| 80/95分工模式 | 重新定义 PM 与研发的协作边界 |

## Success Criteria

### User Success

| 指标 | 定义 | 目标 |
|------|------|------|
| **PR 一次性通过率** | PM 提交的 PR 被研发直接通过的概率 | ≥ 20% |
| **首次 Review 通过** | PM 首次提交代码即通过研发审核 | 作为「啊哈时刻」追踪 |
| **需求完成数量** | 单用户通过平台完成的需求数 | 持续增长 |

**北极星指标：PR 一次性通过率 ≥ 20%**

**用户情感成功：** 一次成功即足够——PM 只需经历一次"代码被研发认可"的体验，就能建立对平台的信任和持续使用意愿。

### Business Success

| 阶段 | 指标 | 目标值 |
|------|------|--------|
| **3个月验证期** | 累计完成需求数 | 20 个 |
| **3个月验证期** | 活跃用户数 | 3 个 |
| **3个月验证期** | PR 一次性通过率 | ≥ 20% |
| **12个月增长期** | 活跃用户数 | 10 个 |
| **12个月增长期** | 用户口碑推荐 | 有机增长 |

### Technical Success

| 指标 | 量化标准 | 测量方法 |
|------|----------|----------|
| **功能完整性** | 8 个核心工作流步骤 100% 可用 | 端到端测试覆盖所有步骤，通过率 100% |
| **稳定性** | 线上 P0 Bug = 0，P1 Bug ≤ 3 | Bug Tracker 追踪，P0 定义：阻塞核心流程 |
| **可用性** | PM 首次使用可在无外部帮助下完成完整流程 | 真实 PM 测试，任务完成率 ≥ 80% |

### Measurable Outcomes

- **MVP 验证标准：** 有一个需求成功通过 PR 审核
- **进入增长期信号：** 累计 20 个需求完成 + 20% 一次性通过率

### Success Metrics Traceability

| 成功指标 | 关联用户旅程 | 验证场景 | 对应能力 |
|----------|--------------|----------|----------|
| PR 一次性通过率 ≥ 20% | Journey 1: PM 首次成功 | PM 提交 PR 被研发直接合并 | 代码生成 + 规范遵循 |
| 首次 Review 通过（啊哈时刻） | Journey 1: PM 首次成功 | PM 第一次代码被研发认可 | 工作流引导 + 对话交互 |
| 需求完成数量持续增长 | Journey 1 + Journey 2 | PM 持续使用平台完成需求 | 全流程可用性 |
| 8 个核心步骤 100% 可用 | Journey 1-4 所有旅程 | 端到端流程可完成 | 全部 FR 实现 |
| 线上 P0 Bug = 0 | Journey 2: PM 失败恢复 | 异常场景可恢复，不阻塞流程 | 可靠性 + 错误处理 |
| PM 任务完成率 ≥ 80% | Journey 1 + Journey 2 | PM 首次使用可独立完成流程 | 界面引导 + 对话式交互 |
| AI 遵循项目规范 | Journey 3: 研发项目准备 | 生成代码符合仓库架构文档规范 | 规范识别与学习（FR20-FR23） |
| PR 包含完整上下文 | Journey 4: 研发 Review | PR 含变更摘要 + Epic/Story 关联 + 跨仓库引用 | PR 展示（FR39-FR41） |

## Product Scope

### MVP - Minimum Viable Product

| 功能 | 说明 |
|------|------|
| Clerk 登录（邮箱/Google/GitHub Account） | 无独立账号系统 |
| GitHub OAuth 授权（仓库访问） | 用于仓库读写权限授权 |
| 项目管理 | 创建项目并导入多个 GitHub 仓库（后端 + 多前端） |
| AI 渠道配置 | 支持 Claude Code、Codex（用户配置中转服务 URL + API Key） |
| 工作流引导 | 拉取代码 → 创建分支 → 史诗 → 故事 → 开发 → 验证 → PR |
| 对话式需求实现 | 多轮对话澄清和调整 |
| 代码生成与 PR | 自动 commit、push、创建 PR（按仓库分别提交） |
| 项目类型支持 | Flutter、Java (Spring)、Next.js |

### Growth Features (Post-MVP)

| 功能 | 状态 |
|------|------|
| 多项目管理 | 根据用户反馈优化 |
| 高级报表/数据分析 | 根据用户反馈优化 |
| 更多项目类型支持 | 根据用户反馈优化 |
| 更多 AI 渠道 | 根据用户反馈优化 |
| AI 服务失败自动重试策略 | 增长期引入 |

### Vision (Future)

- 更高的代码质量和一次性通过率
- 更智能的需求理解和代码生成
- 更强的项目规范自学习能力
- 团队协作和权限管理
- 数据分析和效率报表

## User Journeys

### Journey 1: PM 小李的首次成功之旅（主要用户 - 成功路径）

**Opening Scene（开场）：**
小李是创业公司的产品经理，团队正在推行"人人都是 Builder"的 AI Native 文化。她刚用 Cursor 写了一个登录页面的 demo，兴冲冲给研发看，却被告知"这个架构不对，没法用"。她沮丧地想：明明功能都实现了，为什么就是不能用？

**Rising Action（发展）：**
1. 小李听说了 ai-builder，通过 Clerk 使用 GitHub 账号一键登录
2. 创建一个新项目"电商平台"，导入三个 GitHub 仓库：
   - 后端 Spring 仓库（仓库A）
   - Flutter 移动端仓库（仓库B）
   - Next.js Web端仓库（仓库C）
3. 配置好 Claude Code 的 API Key
4. 进入工作流：创建一个"用户个人资料编辑"的史诗
5. AI 引导她描述需求，理解这个功能涉及后端 API + Flutter 界面
6. AI 自动拆解成用户故事，并标注每个故事对应哪个仓库
7. 通过对话一步步实现每个故事，AI 自动遵循各仓库的规范

**Climax（高潮）：**
小李点击"提交 PR"，系统分别在后端和 Flutter 仓库创建了 PR。研发小王 Review 后回复："代码结构很清晰，符合我们的规范，直接合并了。" 小李愣了一下，然后露出难以置信的笑容——**这是她第一次写的代码被研发认可！**

**Resolution（结局）：**
从此，小李不再只是"写 PRD 等开发"的产品经理。她可以自己实现需求的80%，而且能同时处理前后端代码。团队的需求周期从一个月缩短到几天。

### Journey 2: PM 小李的失败恢复之旅（主要用户 - 边缘情况）

**Opening Scene（开场）：**
小李正在项目中实现一个"订单导出"功能，已经完成了后端 API 和 Flutter 端的展示。

**Rising Action（发展）：**
1. 在实现 Next.js Web 端时，AI 生成的代码涉及一个她不理解的状态管理问题
2. 运行验证时报错了，她看不懂错误信息
3. 她尝试通过对话描述问题，AI 提供了修复建议
4. 修复后再次验证，还是报错

**Climax（高潮）：**
小李决定先提交后端和 Flutter 端的 PR，在 Next.js 的 PR 中标注"需要研发协助"。

**Resolution（结局）：**
研发小王看到后，快速定位 Next.js 的问题并修复。小李完成了三个仓库中两个的工作，研发只需补充一小部分。**即使不是100%成功，她仍然大幅减少了研发的工作量。**

### Journey 3: 研发小王的项目准备之旅（次要用户 - 准备阶段）

**Opening Scene（开场）：**
小王是团队的技术负责人，他相信 AI Native 能提升团队效率，但担心 PM 产出的代码会破坏项目架构。

**Rising Action（发展）：**
1. 小王在 GitHub 上维护好三个仓库：
   - 后端 Spring 仓库：完善架构文档、代码规范
   - Flutter 仓库：定义好组件结构、状态管理规范
   - Next.js 仓库：配置好目录结构、API 调用规范
2. 每个仓库都有清晰的 README 和示例代码
3. 告诉 PM 小李：可以创建项目并导入这三个仓库了

**Climax（高潮）：**
当小李第一次提交 PR 时，小王惊讶地发现三个仓库的代码都遵循了各自的规范——Spring 的分层架构对、Flutter 的组件结构对、Next.js 的目录约定也对。

**Resolution（结局）：**
小王意识到，他前期在每个仓库花的文档时间是值得的。AI 能理解并遵循不同仓库的规范，他可以专注于架构优化。**他从"实现者"变成了"审核者"和"优化者"。**

### Journey 4: 研发小王的日常 Review 之旅（次要用户 - 日常协作）

**Opening Scene（开场）：**
小王收到通知：小李的一个需求涉及后端和 Flutter 两个仓库，各提交了一个 PR。

**Rising Action（发展）：**
1. 打开后端 PR，代码逻辑正确，有几处可以优化
2. 打开 Flutter PR，界面代码清晰，状态管理符合规范
3. 两个 PR 的关联关系清晰，能看出是同一个需求的不同部分
4. 分别做了小优化，留下建设性评论

**Climax（高潮）：**
小王花了40分钟 Review 两个仓库的 PR，而不是从零实现可能需要的一天半。

**Resolution（结局）：**
两个 PR 合并。小王的工作从"实现前后端功能"变成了"Review + 优化多仓库代码"。**他有更多时间思考整体架构和跨仓库的技术一致性。**

### Journey Requirements Summary

| 旅程 | 揭示的能力需求 | 对应 FR |
|------|---------------|---------|
| PM 首次成功 | Clerk 登录 + GitHub OAuth 授权、项目管理（含多仓库导入）、AI 渠道配置、工作流引导、跨仓库需求实现、多 PR 提交 | FR1-FR19, FR24-FR38, FR42-FR56 |
| PM 失败恢复 | 错误提示、对话式调试、按仓库部分提交、故事状态管理 | FR49-FR51, FR36-FR37, FR53-FR54 |
| 研发项目准备 | 仓库架构文档读取、项目规范自动识别与学习、规范摘要展示 | FR20-FR23 |
| 研发日常 Review | PR 变更摘要、Epic/Story 上下文关联、多仓库 PR 交叉引用 | FR39-FR41 |

**关键产品概念：**
- 一个项目 = 多个 GitHub 仓库（后端 + 多前端）
- 需求可能跨多个仓库实现
- PR 按仓库分别提交，但逻辑上关联

## Innovation & Novel Patterns

### Detected Innovation Areas

**1. 范式创新：人人都是 Builder**

| 维度 | 传统模式 | ai-builder 模式 |
|------|----------|-----------------|
| **代码产出者** | 仅研发人员 | PM + AI |
| **PM 角色** | 需求提出者 | 需求实现者 |
| **研发角色** | 从零实现 | 审核优化 |
| **协作模式** | 串行交接 | 并行协作 |

**2. 80分标准的务实定义**

| 维度 | 80分标准 | 研发优化到95分 |
|------|----------|----------------|
| **功能完整度** | 核心功能可用 | 边界情况完善 |
| **代码规范** | 符合项目规范 | 最佳实践优化 |
| **代码质量** | 可读可维护 | 性能和架构优化 |

### Market Context & Competitive Landscape

| 竞品 | 定位 | 局限性 |
|------|------|--------|
| **Devin.ai** | AI 软件工程师 | 面向技术人员设计 |
| **Cursor** | AI 代码编辑器 | 需要编程基础 |
| **BMAD-METHOD** | 开发方法论 | 仍需技术人员操作 |
| **低代码平台** | 可视化开发 | 灵活性有限，难以适配项目规范 |

**核心差异化：** 唯一专为非技术人员设计的 AI 开发平台，通过项目规范自适应确保代码可用性。

### Validation Approach

| 验证点 | 验证方法 |
|--------|----------|
| **非技术人员可用性** | PM 能否独立完成端到端工作流 |
| **代码规范符合度** | 研发 Review 时规范相关改动占比 |
| **80分达标率** | PR 一次性通过率 ≥ 20% |

## Technical Architecture

ai-builder 是 SaaS B2B 开发者工具平台，结合云端服务与 AI 代码生成能力。

### SaaS 特性范围（MVP）

| SaaS 特性 | MVP 状态 | 说明 |
|-----------|----------|------|
| **tenant_model** | 单用户隔离 | 无多租户需求，每用户独立数据空间 |
| **rbac_matrix** | N/A | MVP 无团队协作，无权限矩阵需求 |
| **subscription_tiers** | 免费 | MVP 阶段免费使用，无订阅分层 |
| **api_versioning** | N/A | 无对外 API，仅内部服务调用 |
| **admin_dashboard** | N/A | MVP 无需后台管理系统 |
| **billing_integration** | N/A | MVP 阶段不涉及付费 |
| **audit_logging** | 基础 | 仅记录关键操作日志（登录、PR提交） |

### Developer Tool 特性范围（MVP）

| Developer Tool 特性 | MVP 状态 | 说明 |
|--------------------|----------|------|
| **language_matrix** | 3 种项目类型 | Java (Spring) 后端、Flutter 移动前端、Next.js Web 前端 |
| **installation_methods** | SaaS（无本地安装） | 用户通过浏览器访问，无需安装客户端或 CLI |
| **api_surface** | N/A | MVP 不对外暴露 API，平台通过 Web UI 交互 |
| **code_examples** | N/A | ai-builder 是终端用户工具，非 SDK/Library，无代码示例需求 |
| **migration_guide** | N/A | Greenfield MVP，无历史系统迁移需求 |
| **plugin_system** | N/A | MVP 不支持插件扩展 |

**Out of Scope（Developer Tool 排除项）**
- cli_interface（MVP 仅提供 Web UI，无 CLI）

### 合规要求（compliance_reqs）

| 合规维度 | MVP 状态 | 说明 |
|----------|----------|------|
| **数据隐私** | 基础合规 | 不存储用户源代码（代码操作通过 GitHub API 直接执行），仅存储元数据（项目配置、史诗/故事状态） |
| **第三方 API 使用** | 用户自负 | AI API 由用户自行配置中转服务，平台不直接持有 AI 服务合约 |
| **GitHub 数据** | OAuth 授权范围 | 仅申请 repo + user:email 权限，用户可随时撤销授权 |
| **GDPR/隐私法规** | N/A | MVP 面向国内创业团队，暂不涉及跨境合规 |
| **SOC2/ISO27001** | N/A | MVP 阶段不需要安全认证，后续根据客户需求评估 |

**业务边界说明：**
- ai-builder 不存储用户代码内容，代码操作全部通过 GitHub API 完成
- AI API Key 由用户自行管理，平台仅负责加密存储和中转调用
- MVP 阶段用户群体为国内创业团队，无跨境数据合规需求

**MVP 范围决策依据：**
- 目标用户为个人 PM，非团队协作场景
- 验证核心价值（PM 产出可用代码）优先于商业化功能
- 快速验证假设，功能精简到最小可行

### 用户模型

| 维度 | MVP 方案 |
|------|----------|
| **认证** | Clerk 登录（邮箱/Google/GitHub Account） |
| **用户隔离** | 每用户独立项目，无共享 |
| **权限** | 用户只能访问自己的项目和已授权仓库 |

### 权限与订阅模型

#### RBAC 矩阵（MVP 简版）

| 角色 | 权限范围 |
|------|----------|
| **Owner** | 创建/删除项目、导入仓库、配置 AI 渠道、提交 PR |
| **Member** | 查看项目、参与需求流程、提交 PR（MVP 预留） |

#### 订阅层级（MVP）

| 层级 | 说明 |
|------|------|
| **Free（MVP）** | 单一免费层级；不区分功能/配额；后续增长期再定义层级 |

### 项目模型

| 维度 | 说明 |
|------|------|
| **项目结构** | 一个项目 = 多个 GitHub 仓库 |
| **仓库类型** | 后端（Spring）+ 前端（Flutter/Next.js） |
| **技术栈识别** | AI 自动识别仓库技术栈类型 |

### 核心工作流（Epic → Story → PR）

```
┌─────────────────────────────────────────────────────────────────────┐
│                         需求（史诗）开发流程                          │
├─────────────────────────────────────────────────────────────────────┤
│                                                                     │
│  ┌──────────────┐                                                   │
│  │ PM + Codex   │ ─────→ 生成史诗（Epic）                            │
│  │  交流需求     │                                                   │
│  └──────────────┘                                                   │
│         │                                                           │
│         ▼                                                           │
│  ┌──────────────────────────────────────────────────────────────┐   │
│  │                    Story 开发循环                             │   │
│  │  ┌─────────┐   ┌─────────┐   ┌─────────┐   ┌──────┐         │   │
│  │  │  Codex  │ → │ Claude  │ → │  Codex  │ → │ Done │ → PR    │   │
│  │  │ 生成Story│   │  Code   │   │  Code   │   │      │         │   │
│  │  │         │   │  开发    │   │ Review  │   │      │         │   │
│  │  └─────────┘   └────┬────┘   └────┬────┘   └──────┘         │   │
│  │                     │             │                          │   │
│  │                     └─────────────┘                          │   │
│  │                      循环修复直到通过                          │   │
│  │                                                              │   │
│  │  重复上述循环，直到所有 Story 完成                              │   │
│  └──────────────────────────────────────────────────────────────┘   │
│         │                                                           │
│         ▼                                                           │
│  ┌──────────────┐                                                   │
│  │ 史诗完成      │ ← 所有 Story 都 Done                              │
│  └──────────────┘                                                   │
│                                                                     │
└─────────────────────────────────────────────────────────────────────┘
```

### 工作流详细步骤

| 步骤 | 参与者 | 动作 | 输出 |
|------|--------|------|------|
| 1 | PM + Codex | 交流需求，定义史诗 | Epic |
| 2 | Codex | 从当前史诗生成下一个 Story | Story（待开发） |
| 3 | Claude Code | 开发当前 Story | 代码变更 |
| 4 | Codex | Code Review 代码 | Review 结果 |
| 5a | （通过）| Story 状态变为 Done | 可提交 PR |
| 5b | （不通过）| Claude Code 修复 | 返回步骤 4 |
| 6 | 系统 | 检查是否还有待开发 Story | 有→返回步骤2，无→史诗完成 |

### 界面交互流程

平台采用 **步骤面板 + 对话区域** 的双栏布局：

| 界面区域 | 功能 | 说明 |
|----------|------|------|
| **左侧：工作流步骤面板** | 可视化进度展示 | 显示所有步骤状态（待执行/进行中/已完成），PM 可清楚看到当前所在位置 |
| **右侧：对话与操作区域** | 与 AI 交互 | 根据当前步骤动态切换内容（对话框/状态卡片/操作按钮） |

#### 各步骤的界面行为

| 步骤 | 界面内容 | PM 交互方式 |
|------|----------|-------------|
| **创建史诗** | 对话框：PM 用自然语言描述需求 | PM 输入需求描述 → Codex 引导补充细节（如涉及哪些端、核心用户场景） → 生成 Epic 摘要供 PM 确认 |
| **生成故事** | 状态卡片：显示 Codex 正在拆解 Story | 系统自动操作，PM 等待并查看生成的 Story 内容，可通过对话调整 |
| **开发中** | 进度指示器 + 实时日志 | Claude Code 自动开发，PM 可查看进度。遇到问题时 PM 可通过对话补充说明 |
| **Code Review** | Review 结果卡片 | Codex 自动 Review，显示通过/不通过状态。不通过时 PM 可查看问题描述 |
| **修复循环** | 修复进度 + 对话框 | Claude Code 自动修复，PM 可通过对话提供额外上下文 |
| **Story Done** | 操作按钮：提交 PR | PM 点击"提交 PR"按钮，系统按仓库分别创建 PR |

#### 对话交互详细机制

| 对话场景 | AI 角色 | 对话内容 | PM 预期输入 |
|----------|---------|----------|-------------|
| **需求描述** | Codex 引导 | "请描述你想要实现的功能"，追问用户场景、涉及的端 | 自然语言需求描述，如"我要做一个用户资料编辑功能" |
| **需求澄清** | Codex 追问 | "这个功能需要支持头像上传吗？涉及哪些仓库？" | PM 回答是/否，补充细节 |
| **Epic 确认** | Codex 总结 | 展示结构化 Epic 摘要，请 PM 确认 | PM 确认或提出修改 |
| **Story 调整** | Codex 协商 | 展示生成的 Story，询问是否需要调整 | PM 确认或要求拆分/合并 |
| **开发问题** | 系统通知 | "开发遇到问题：[问题描述]，需要您的帮助" | PM 用自然语言描述期望行为 |
| **结果反馈** | 系统通知 | "Story 已完成/Review 不通过：[原因]" | PM 查看结果或提供补充信息 |

### 关键设计点

| 要点 | 说明 |
|------|------|
| **串行开发** | Story 逐个生成、逐个开发，非批量 |
| **验证闭环** | Codex Review + CC 修复循环直到通过 |
| **增量提交** | 每个 Story Done 后可独立提交 PR |
| **史诗完整性** | 所有 Story 完成后，Epic 才算完成 |
| **分支命名** | `feature/<需求英文名称或版本号>_<用户GitHub账号>` |

### AI 渠道配置

| 渠道 | 配置项 | 说明 |
|------|--------|------|
| **Codex** | API URL | 用户配置的中转服务地址 |
| **Codex** | API Key | 用户配置的中转服务密钥 |
| **Claude Code** | API URL | 用户配置的中转服务地址 |
| **Claude Code** | API Key | 用户配置的中转服务密钥 |

**设计要点：**
- 用户自行配置中转服务地址和密钥
- 不直接调用官方 API
- API Key 加密存储

### 核心集成

| 集成 | 用途 | 优先级 |
|------|------|--------|
| **Clerk** | 用户注册/登录与会话管理 | P0 |
| **GitHub API** | OAuth 授权（仓库读写）、分支管理、PR 创建 | P0 |
| **Codex** | 需求交流、Story 生成、Code Review | P0 |
| **Claude Code** | Story 代码开发、问题修复 | P0 |

### 项目类型支持

| 技术栈 | 类型 | MVP 支持 |
|--------|------|----------|
| **Java (Spring)** | 后端 | ✅ |
| **Flutter** | 移动前端 | ✅ |
| **Next.js** | Web 前端 | ✅ |

### 数据存储需求

| 数据类型 | 存储需求 |
|----------|----------|
| 用户信息 | GitHub 用户 ID、Token |
| 项目配置 | 项目名称、关联仓库列表 |
| Codex 配置 | API URL + API Key（加密存储） |
| Claude Code 配置 | API URL + API Key（加密存储） |
| 史诗状态 | 史诗内容、关联 Story 列表、完成状态 |
| 故事状态 | Story 内容、开发状态、Review 状态、PR 链接 |

### 安全考虑

| 关注点 | 措施 |
|--------|------|
| GitHub Token | 安全存储，最小权限原则 |
| AI API URL | 用户自行配置中转服务地址 |
| AI API Key | 用户自行配置，加密存储 |

> 注：HTTPS 加密通过运维方式解决，不在产品范围内

## Project Scoping & Phased Development

### MVP Strategy & Philosophy

**MVP 方法：** 问题解决型 MVP（Problem-Solving MVP）
- 聚焦验证核心假设：PM 能否产出符合项目规范的代码
- 最小验证标准：有一个需求成功通过 PR 审核
- 快速学习路径：通过真实 PM 使用场景验证

**资源需求：**
- 创始人自研为主
- 核心技术：Web 前端 + 后端 + AI 集成

### MVP Feature Set (Phase 1)

**核心用户旅程支持：**
- ✅ PM 首次成功之旅（啊哈时刻）
- ✅ PM 失败恢复之旅（容错机制）
- ✅ 研发项目准备之旅（规范配置）
- ✅ 研发日常 Review 之旅（PR 审核）

**Must-Have 能力：**

| 能力 | 说明 |
|------|------|
| Clerk 登录（邮箱/Google/GitHub Account） | 无独立账号系统 |
| GitHub OAuth 授权（仓库访问） | 用于仓库读写权限授权 |
| 项目管理 | 创建项目 + 多仓库导入 |
| AI 渠道配置 | Codex + Claude Code（用户配置中转服务） |
| 工作流引导 | Epic → Story → 开发 → Review → PR |
| 项目类型支持 | Flutter、Spring、Next.js |

### Epic 2: Identity & Workspace Setup

用户可通过 Clerk 完成注册/登录（邮箱、Google、GitHub Account）与登出，并可创建/删除工作空间（项目）。

**Story 拆分（覆盖 FR1/FR3/FR4/FR8）：**

1. **Story 2.1：用户注册/登录（Clerk 多方式）**
   - 覆盖 FR：FR1
   - 验收标准：
     - Given 未登录用户在登录页
     - When 选择 Clerk 登录方式（邮箱/Google/GitHub Account）并完成授权
     - Then 5 秒内进入系统并显示用户头像和用户名
     - Given 登录被取消或失败
     - When 返回系统
     - Then 显示失败原因并保持在登录页
2. **Story 2.2：用户登出**
   - 覆盖 FR：FR3
   - 验收标准：
     - Given 用户已登录
     - When 点击登出
     - Then 立即清除本地会话并跳转至登录页
3. **Story 2.3：创建工作空间（项目）**
   - 覆盖 FR：FR4
   - 验收标准：
     - Given 用户已登录并进入项目列表页
     - When 输入项目名称（1-50字符）并点击创建
     - Then 1 秒内显示新项目卡片
     - Given 项目名称重复或不合法
     - When 提交创建
     - Then 显示错误提示且不创建项目
4. **Story 2.4：删除工作空间（项目）**
   - 覆盖 FR：FR8
   - 验收标准：
     - Given 用户在项目列表中选择某项目
     - When 点击删除
     - Then 弹出二次确认对话框（含项目名称）
     - Given 用户确认删除
     - When 提交确认
     - Then 1 秒内从项目列表中移除
     - Given 用户取消删除
     - When 关闭确认对话框
     - Then 项目保持不变

### Post-MVP Features

**Phase 2: Growth**

| 能力 | 触发条件 |
|------|----------|
| 多项目管理 | 用户反馈需求 |
| 高级报表/数据分析 | 用户量增长后 |
| 更多项目类型支持 | 用户反馈需求 |
| 更多 AI 渠道 | 用户反馈需求 |

**Phase 3: Vision**

| 能力 | 说明 |
|------|------|
| 团队协作 | 多人协作、权限管理 |
| 更高通过率 | 从20%持续提升 |
| 规范自学习 | 更智能的项目规范理解 |

### Risk Mitigation Strategy

**技术风险：**

| 风险 | 缓解策略 |
|------|----------|
| AI 生成代码质量不稳定 | Codex Review 闭环验证 |
| 多仓库协调复杂度 | 串行 Story 开发，逐个验证 |
| 项目规范理解偏差 | 依赖仓库文档 + 示例代码 |

**市场风险：**

| 风险 | 缓解策略 |
|------|----------|
| PM 不愿意尝试新工具 | 从认同 AI Native 的团队切入 |
| 研发抵触80分代码 | 强调"减负"定位，非替代 |

**资源风险：**

| 风险 | 缓解策略 |
|------|----------|
| 开发周期拉长 | MVP 功能已精简到最小 |
| 资源不足 | 单人可完成核心功能 |

## Functional Requirements

### 用户认证与管理

- **FR1:** 用户可以通过 Clerk 完成注册/登录（邮箱、Google、GitHub Account）。验收标准：点击登录按钮后进入 Clerk 授权流程，授权成功后 5 秒内返回系统并显示用户头像和用户名
- **FR2:** 用户可以查看自己的 GitHub 授权状态。验收标准：在设置页面显示当前授权状态（已授权/未授权）和授权范围（repo、user:email）
- **FR3:** 用户可以登出系统。验收标准：点击登出后立即清除本地会话，跳转至登录页面

### 项目管理

- **FR4:** 用户可以创建新项目并命名。验收标准：输入项目名称（1-50字符）后点击创建，1 秒内显示新项目卡片
- **FR5:** 用户可以向项目中导入 1~10 个 GitHub 仓库。验收标准：选择仓库后点击导入，每个仓库导入完成后显示成功/失败状态，全部完成后刷新仓库列表
- **FR6:** 用户可以查看项目中已导入的仓库列表。验收标准：列表显示每个仓库的名称、类型标签、导入时间，支持按名称排序
- **FR7:** 用户可以从项目中移除已导入的仓库。验收标准：点击移除后显示确认对话框，确认后 1 秒内从列表中移除
- **FR8:** 用户可以删除项目。验收标准：点击删除后显示二次确认对话框（含项目名称），确认后 1 秒内从项目列表中移除
- **FR9:** 系统可以自动识别导入仓库的项目类型（Spring/Flutter/Next.js）。验收标准：导入完成后 3 秒内显示识别结果，准确率 ≥ 95%（基于 package.json/pubspec.yaml/pom.xml 等配置文件判断）

### AI 渠道配置

- **FR10:** 用户可以配置 Codex 的 API URL 和 API Key。验收标准：表单校验 URL 格式和 Key 非空，保存成功后显示"配置已保存"提示
- **FR11:** 用户可以配置 Claude Code 的 API URL 和 API Key。验收标准：表单校验 URL 格式和 Key 非空，保存成功后显示"配置已保存"提示
- **FR12:** 用户可以测试 AI 渠道配置是否有效。验收标准：点击测试按钮后 10 秒内返回测试结果（成功/失败+具体错误原因）
- **FR13:** 系统可以安全存储用户的 AI API Key。验收标准：数据库中 API Key 字段采用行业标准强度加密存储，无法逆向获取明文

### 史诗管理

- **FR14:** 用户可以通过对话框用自然语言描述需求。验收标准：输入框支持多行文本（≤2000字符），发送后 3 秒内显示 AI 响应
- **FR15:** Codex 可以在对话中引导 PM 逐步补充需求（涉及哪些仓库、核心用户场景、功能边界）。验收标准：AI 至少提出 3 个引导性问题，覆盖涉及仓库、用户场景、功能边界三个维度
- **FR16:** Codex 可以根据对话内容生成结构化的 Epic 摘要供 PM 确认。验收标准：摘要包含史诗标题、目标描述、涉及仓库列表、预估 Story 数量，格式化展示
- **FR17:** 用户可以确认或修改 Epic 摘要后正式创建史诗。验收标准：点击确认后 1 秒内创建史诗，点击修改后可编辑摘要内容并重新生成
- **FR18:** 用户可以查看当前史诗的内容和状态。验收标准：史诗详情页显示标题、描述、状态、创建时间、关联 Story 数量
- **FR19:** 用户可以查看史诗下所有故事的状态汇总。验收标准：显示 Story 列表及各状态计数（待开发/开发中/Review中/Done）

### 项目规范识别与学习（Journey 3 支撑）

- **FR20:** 系统在导入仓库后自动读取仓库中的架构文档（README、docs 目录、规范文件）。验收标准：导入后 30 秒内完成文档扫描，识别 README.md、docs/**/*.md、CONTRIBUTING.md 等文件
- **FR21:** 系统可以基于仓库文档和代码结构自动识别项目规范（目录结构、命名约定、分层架构）。验收标准：扫描完成后生成规范摘要，包含目录结构模式、命名规范（≥3 条）、分层说明
- **FR22:** AI 在代码生成时自动遵循已识别的项目规范。验收标准：生成的代码目录位置、命名风格、分层架构与项目现有代码一致，研发抽检一致性 ≥ 80%
- **FR23:** 用户可以查看系统识别到的项目规范摘要。验收标准：点击查看后显示结构化的规范摘要（目录结构、命名约定、分层架构各 1 个区块）

### 故事开发工作流

- **FR24:** Codex 可以从当前史诗生成下一个待开发的故事（Story）。验收标准：点击生成后 30 秒内返回 Story 内容，包含标题、描述、验收条件、预估涉及仓库
- **FR25:** 用户可以查看当前故事的内容和开发状态。验收标准：Story 卡片显示标题、描述、状态标签、关联仓库、创建时间
- **FR26:** Claude Code 可以根据故事内容开发代码。验收标准：代码可编译通过（编译 0 错误）并满足既定测试用例（测试通过率 100%）
- **FR27:** Codex 可以对 Claude Code 开发的代码进行 Code Review。验收标准：Review 完成后返回结果（通过/不通过）和具体问题列表（如有），Review 时间 ≤ 60 秒
- **FR28:** 当 Code Review 不通过时，Claude Code 可以根据反馈修复代码。验收标准：收到反馈后自动开始修复，修复完成后重新提交 Review，直到通过或用户介入
- **FR29:** 系统可以在 Code Review 通过后将故事状态标记为 Done。验收标准：Review 通过后 1 秒内自动更新状态为 Done，界面实时刷新
- **FR30:** 系统可以在故事 Done 后自动生成下一个故事（如果还有）。验收标准：当前 Story Done 后 3 秒内检查剩余需求，有则自动触发生成，无则提示"史诗所有故事已完成"
- **FR31:** 系统可以在所有故事完成后将史诗状态标记为完成。验收标准：最后一个 Story Done 后 1 秒内自动更新史诗状态为"已完成"

### Git 操作与 PR 提交

- **FR32:** 系统可以自动拉取仓库最新代码。验收标准：拉取完成后显示成功提示，失败时显示具体错误原因并支持重试
- **FR33:** 系统可以自动创建 feature 分支，命名规则：`feature/<需求英文名称或版本号>_<用户GitHub账号>`。验收标准：分支创建成功后自动切换到新分支，界面显示当前分支名
- **FR34:** 系统可以自动 commit 代码变更。验收标准：commit 成功后显示 commit hash 和变更文件数，失败时显示错误原因
- **FR35:** 系统可以自动 push 代码到远程仓库。验收标准：push 成功后显示远程分支链接，失败时显示错误原因并支持重试
- **FR36:** 用户可以在故事 Done 后提交 PR。验收标准：点击提交 PR 按钮后，30 秒内完成 PR 创建并返回 PR 链接
- **FR37:** 系统可以为每个涉及的仓库分别创建 PR。验收标准：多仓库场景下，每个仓库独立创建 PR，全部完成后显示 PR 链接列表
- **FR38:** 系统可以在 PR 中关联相关的史诗和故事信息。验收标准：PR 描述自动包含 Epic 标题、Story 标题、验收条件

### PR 展示与审核支撑（Journey 4 支撑）

- **FR39:** 系统在 PR 描述中自动生成代码变更摘要。验收标准：PR 描述包含变更文件列表、主要修改说明（≤500字）、影响范围
- **FR40:** 系统在 PR 中包含关联的 Epic 和 Story 上下文信息。验收标准：PR 描述包含 Epic 标题、Story 标题、验收条件清单
- **FR41:** 同一需求涉及多个仓库的 PR 之间包含交叉引用链接。验收标准：PR 描述底部包含"关联 PR"区块，列出其他仓库 PR 的链接

### 界面工作流引导

- **FR42:** 系统在工作流步骤面板中展示所有步骤及其状态（待执行/进行中/已完成）。验收标准：步骤面板显示 8 个核心步骤，每个步骤有状态图标（待执行灰色/进行中蓝色/已完成绿色）
- **FR43:** 系统根据当前步骤动态切换右侧操作区域内容（对话框/状态卡片/操作按钮）。验收标准：切换步骤后 1 秒内更新右侧内容
- **FR44:** 系统在每个步骤提供明确的下一步操作指引。验收标准：每个步骤底部显示"下一步"按钮或提示文字，指引内容与当前步骤相关

### 对话式交互

- **FR45:** 用户可以在创建史诗步骤中通过自然语言描述需求。验收标准：输入框支持多行文本（≤2000字符），发送后 3 秒内显示 AI 响应
- **FR46:** Codex 可以在对话中主动引导 PM 补充需求细节（涉及的端、核心场景、优先级）。验收标准：AI 根据上下文主动提问，问题覆盖涉及的端、核心场景、优先级
- **FR47:** 用户可以在对话中确认或修改 Codex 生成的 Epic 摘要。验收标准：显示确认/修改按钮，修改后可重新生成摘要
- **FR48:** 用户可以在 Story 生成后通过对话调整 Story 内容。验收标准：支持对 Story 的标题、描述、验收条件进行对话式修改
- **FR49:** 用户可以在开发遇到问题时通过对话补充上下文。验收标准：问题出现时自动弹出对话框，用户输入后 AI 在 30 秒内响应
- **FR50:** AI 可以根据用户描述提供修复建议。验收标准：AI 响应包含问题分析和至少 1 条可操作的修复建议
- **FR51:** 用户可以在任何工作流节点与 AI 进行多轮对话。验收标准：对话历史保留，支持上下文连续对话（≤20轮）

### 状态跟踪与可见性

- **FR52:** 用户可以查看当前工作流的进度状态（步骤面板可视化）。验收标准：步骤面板实时显示当前步骤高亮，已完成步骤显示勾选标记
- **FR53:** 用户可以查看每个故事的开发状态（待开发/开发中/Review中/Done）。验收标准：Story 卡片显示状态标签，颜色区分（灰/蓝/橙/绿）
- **FR54:** 用户可以查看 Code Review 的结果和问题描述。验收标准：Review 结果页显示通过/不通过状态、问题列表（含行号和说明）
- **FR55:** 用户可以查看已提交 PR 的链接。验收标准：PR 提交成功后显示可点击的 GitHub PR 链接，支持新窗口打开
- **FR56:** 系统在自动操作（开发/Review/修复）时显示实时进度指示。验收标准：自动操作时显示进度条或加载动画，每 5 秒更新状态文字

## Non-Functional Requirements

### Security（安全）

| NFR | 要求 | 量化指标 | 验证方法 |
|-----|------|----------|----------|
| **NFR-S1** | GitHub Token 加密存储 | 行业标准强度加密（不可逆） | 数据库检查：Token 字段不可逆向明文 |
| **NFR-S2** | AI API Key 加密存储 | 行业标准强度加密（不可逆） | 数据库检查：API Key 字段不可逆向明文 |
| **NFR-S3** | 用户数据隔离 | 100% 请求仅返回当前用户数据 | 自动化测试：跨用户数据访问测试全部失败 |
| **NFR-S4** | GitHub OAuth 授权最小权限 | 仅申请 repo、user:email 权限 | OAuth 配置审查 |

### Integration（集成）

| NFR | 要求 | 量化指标 | 验证方法 |
|-----|------|----------|----------|
| **NFR-I1** | GitHub API 失败优雅处理 | 100% 失败场景有明确错误提示 | 模拟 API 失败，验证错误提示显示 |
| **NFR-I3** | AI 配置校验 | 首次使用前 100% 触发配置检查 | 配置错误时验证阻止操作并提示 |

### Reliability（可靠性）

| NFR | 要求 | 量化指标 | 验证方法 |
|-----|------|----------|----------|
| **NFR-R1** | 工作流状态持久化 | 页面刷新后状态恢复率 100% | 刷新页面，验证史诗/故事状态保留 |
| **NFR-R2** | 代码变更持久化 | commit 成功后数据丢失率 0% | 模拟 commit 后断开，验证数据完整 |
| **NFR-R3** | 异常恢复能力 | 异常退出后可恢复率 ≥ 95% | 模拟进程终止，验证状态恢复 |

### Performance（性能）

| NFR | 要求 | 量化指标 | 验证方法 |
|-----|------|----------|----------|
| **NFR-P1** | 页面加载性能 | 首屏加载 < 3 秒（不含 AI） | Lighthouse 性能测试，P95 < 3s |
| **NFR-P2** | AI 交互超时处理 | 超时阈值 120 秒，超时后 100% 显示反馈 | 模拟 AI 超时，验证提示显示 |
